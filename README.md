# blivechat

> ğŸ”‘ This is a muli component. You can find the main repository [here](https://github.com/cdfmlr/muvtuber).

ç”¨äºOBSçš„ä»¿YouTubeé£æ ¼çš„bilibiliç›´æ’­è¯„è®ºæ ã€‚

> About this fork:
> 
> è¿™ä¸ª fork é’ˆå¯¹ blivechat åœ¨ muli é¡¹ç›®ä¸­çš„åº”ç”¨ï¼Œå¯¹åŸé¡¹ç›®è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œç‰ºç‰²éƒ¨åˆ†åŠŸèƒ½ï¼ˆå¦‚ç¿»è¯‘ã€å¤´åƒï¼‰ï¼Œä»¥æäº†é«˜é²æ£’æ€§ã€‚
> Goto the [main repository](https://github.com/cdfmlr/muvtuber) for more information.

![OBSæˆªå›¾](./screenshots/obs.png)  
![Chromeæˆªå›¾](./screenshots/chrome.png)  
![æ ·å¼ç”Ÿæˆå™¨æˆªå›¾](./screenshots/stylegen.png)  

## ç‰¹æ€§
* å…¼å®¹YouTubeç›´æ’­è¯„è®ºæ çš„æ ·å¼
* ä»˜è´¹ç¤¼ç‰©æ¨¡ä»¿é†’ç›®ç•™è¨€æ˜¾ç¤º
* é«˜äº®èˆ°é˜Ÿã€æˆ¿ç®¡ã€ä¸»æ’­çš„ç”¨æˆ·å
* æ”¯æŒå±è”½å¼¹å¹•ã€åˆå¹¶ç›¸ä¼¼å¼¹å¹•ç­‰è®¾ç½®
* è‡ªå¸¦ä¸¤ç§æ ·å¼ç”Ÿæˆå™¨ï¼Œç»å…¸YouTubeé£æ ¼å’Œä»¿å¾®ä¿¡é£æ ¼
* æ”¯æŒå‰ç«¯ç›´è¿Bç«™æœåŠ¡å™¨æˆ–è€…é€šè¿‡åç«¯è½¬å‘
* æ”¯æŒè‡ªåŠ¨ç¿»è¯‘å¼¹å¹•ã€é†’ç›®ç•™è¨€åˆ°æ—¥è¯­ï¼Œå¯ä»¥åœ¨åå°é…ç½®ç¿»è¯‘ç›®æ ‡è¯­è¨€
* æ”¯æŒæ ‡æ³¨æ‰“èµç”¨æˆ·åçš„è¯»éŸ³ï¼Œå¯é€‰æ‹¼éŸ³æˆ–æ—¥æ–‡å‡å
* æ”¯æŒé…ç½®è‡ªå®šä¹‰è¡¨æƒ…ï¼Œä¸éœ€è¦å¼€é€šBç«™å®˜æ–¹è¡¨æƒ…

## ä½¿ç”¨æ–¹æ³•
ä»¥ä¸‹å‡ ç§æ–¹å¼ä»»é€‰ä¸€ç§å³å¯

### ä¸€ã€æœ¬åœ°ä½¿ç”¨
1. ä¸‹è½½[å‘å¸ƒç‰ˆ](https://github.com/xfgryujk/blivechat/releases)ï¼ˆä»…æä¾›x64 Windowsç‰ˆï¼‰
2. åŒå‡»`blivechat.exe`è¿è¡ŒæœåŠ¡å™¨ï¼Œæˆ–è€…ç”¨å‘½ä»¤è¡Œå¯ä»¥æŒ‡å®šhostå’Œç«¯å£å·ï¼š
    ```sh
    blivechat.exe --host 127.0.0.1 --port 12450
    ```
3. ç”¨æµè§ˆå™¨æ‰“å¼€[http://localhost:12450](http://localhost:12450)ï¼Œè¾“å…¥æˆ¿é—´IDï¼Œå¤åˆ¶æˆ¿é—´URL
4. ç”¨æ ·å¼ç”Ÿæˆå™¨ç”Ÿæˆæ ·å¼ï¼Œå¤åˆ¶CSS
5. åœ¨OBSä¸­æ·»åŠ æµè§ˆå™¨æºï¼Œè¾“å…¥URLå’Œè‡ªå®šä¹‰CSS

**æ³¨æ„äº‹é¡¹ï¼š**

* æœ¬åœ°ä½¿ç”¨æ—¶ä¸è¦å…³é—­blivechat.exeé‚£ä¸ªé»‘æ¡†ï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­è·å–å¤´åƒæˆ–å¼¹å¹•
* æ ·å¼ç”Ÿæˆå™¨æ²¡æœ‰åˆ—å‡ºæ‰€æœ‰æœ¬åœ°å­—ä½“ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨è¾“å…¥æœ¬åœ°å­—ä½“
* å¦‚æœéœ€è¦ä½¿ç”¨ç¿»è¯‘åŠŸèƒ½ï¼Œå»ºè®®çœ‹[é…ç½®å®˜æ–¹ç¿»è¯‘æ¥å£å‚»ç“œå¼æ•™ç¨‹](https://www.bilibili.com/read/cv14663633)

### äºŒã€å…¬å…±æœåŠ¡å™¨
è¯·ä¼˜å…ˆåœ¨æœ¬åœ°ä½¿ç”¨ï¼Œä½¿ç”¨å…¬å…±æœåŠ¡å™¨ä¼šæœ‰æ›´å¤§çš„å»¶è¿Ÿï¼Œè€Œä¸”æœåŠ¡å™¨æ•…éšœæ—¶å¯èƒ½å‘ç”Ÿç›´æ’­äº‹æ•…

* [å…¬å…±æœåŠ¡å™¨](http://chat.bilisc.com/)

### ä¸‰ã€æºä»£ç ç‰ˆï¼ˆè‡ªå»ºæœåŠ¡å™¨æˆ–åœ¨Windowsä»¥å¤–å¹³å°ï¼‰
0. ç”±äºä½¿ç”¨äº†gitå­æ¨¡å—ï¼Œcloneæ—¶éœ€è¦åŠ ä¸Š`--recursive`å‚æ•°ï¼š
    ```sh
    git clone --recursive https://github.com/xfgryujk/blivechat.git
    ```
    å¦‚æœå·²ç»cloneï¼Œæ‹‰å­æ¨¡å—çš„æ–¹æ³•ï¼š
    ```sh
    git submodule update --init --recursive
    ```
1. ç¼–è¯‘å‰ç«¯ï¼ˆéœ€è¦å®‰è£…Node.jsï¼‰ï¼š
    ```sh
    cd frontend
    npm i
    npm run build
    ```
2. è¿è¡ŒæœåŠ¡å™¨ï¼ˆéœ€è¦Python3.6ä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼š
    ```sh
    pip3 install -r requirements.txt
    python3 main.py
    ```
    æˆ–è€…å¯ä»¥æŒ‡å®šhostå’Œç«¯å£å·ï¼š
    ```sh
    python3 main.py --host 127.0.0.1 --port 12450
    ```
3. ç”¨æµè§ˆå™¨æ‰“å¼€[http://localhost:12450](http://localhost:12450)ï¼Œä»¥ä¸‹ç•¥

### å››ã€Dockerï¼ˆè‡ªå»ºæœåŠ¡å™¨ï¼‰
1.  ```sh
    docker run --name blivechat -d -p 12450:12450 \
      --mount source=blivechat-data,target=/mnt/data \
      xfgryujk/blivechat:latest
    ```
2. ç”¨æµè§ˆå™¨æ‰“å¼€[http://localhost:12450](http://localhost:12450)ï¼Œä»¥ä¸‹ç•¥

## è‡ªå»ºæœåŠ¡å™¨ç›¸å…³è¡¥å……
### æœåŠ¡å™¨é…ç½®
æœåŠ¡å™¨é…ç½®åœ¨`data/config.ini`ï¼Œå¯ä»¥é…ç½®æ•°æ®åº“å’Œå…è®¸è‡ªåŠ¨ç¿»è¯‘ç­‰ï¼Œç¼–è¾‘åè¦é‡å¯ç”Ÿæ•ˆ

**è‡ªå»ºæœåŠ¡å™¨æ—¶å¼ºçƒˆå»ºè®®ä¸ä½¿ç”¨åŠ è½½å™¨**ï¼Œå¦åˆ™å¯èƒ½å› ä¸ºæ··åˆHTTPå’ŒHTTPSç­‰åŸå› åŠ è½½ä¸å‡ºæ¥

### å‚è€ƒnginxé…ç½®
`sudo vim /etc/nginx/sites-enabled/blivechat.conf`

```nginx
upstream blivechat {
	keepalive 8;
	# blivechatåœ°å€
	server 127.0.0.1:12450;
}

# å¼ºåˆ¶HTTPS
server {
	listen 80;
	listen [::]:80;
	server_name YOUR.DOMAIN.NAME;

	return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;
	server_name YOUR.DOMAIN.NAME;

	# SSL
	ssl_certificate /PATH/TO/CERT.crt;
	ssl_certificate_key /PATH/TO/CERT_KEY.key;

	client_body_buffer_size 256k;
	client_max_body_size 1.1m;

	# ä»£ç†header
	proxy_http_version 1.1;
	proxy_set_header Host $host;
	proxy_set_header Connection "";
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

	# é™æ€æ–‡ä»¶
	location / {
		root /PATH/TO/BLIVECHAT/frontend/dist;
		# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œäº¤ç»™å‰ç«¯è·¯ç”±
		try_files $uri $uri/ /index.html;
	}
	location /emoticons {
		alias /PATH/TO/BLIVECHAT/data/emoticons;
	}
	# åŠ¨æ€API
	location /api {
		proxy_pass http://blivechat;
	}
	# websocket
	location = /api/chat {
		proxy_pass http://blivechat;

		# ä»£ç†websocketå¿…é¡»è®¾ç½®
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "Upgrade";

		# ç”±äºè¿™ä¸ªå—æœ‰proxy_set_headerï¼Œè¿™äº›ä¸ä¼šè‡ªåŠ¨ç»§æ‰¿
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}
```
